# ADR-010: 错误处理架构决策

## 状态
✅ 已批准

## 决策
采用基于配置驱动的错误处理架构，支持graceful/strict两种模式，并集成结构化日志记录。

## 上下文
- 需要统一的错误处理机制
- 支持不同环境下的灵活配置
- 需要与日志系统集成
- 需要支持错误恢复和自愈

## 决策结果

### 核心组件
1. **ErrorCodeManager**
   - 统一管理错误码和错误信息
   - 支持错误码分类和查询
   - 提供错误格式化功能

2. **配置驱动**
   ```json
   {
     "error_handling": {
       "strategy": "graceful",
       "auto_recovery": true,
       "log_errors": true,
       "max_error_history": 1000
     }
   }
   ```

3. **错误处理策略**
   - `graceful`模式：尽可能继续执行，记录错误
   - `strict`模式：遇到错误立即抛出异常

### 集成点
- 与TemplatedLogger集成，记录结构化日志
- 支持性能监控系统收集错误指标
- 提供API供其他模块报告错误

## 后果

### 优点
- 统一的错误处理接口
- 灵活的配置选项
- 更好的可观测性
- 便于问题诊断

### 缺点
- 增加了代码复杂度
- 需要额外的配置管理
- 性能开销（可忽略）

## 相关决策
- [ADR-008: 日志系统架构](./008-logging.md)
- [ADR-006B: 配置管理架构](./006b-config-management.md)

## 验证
- [x] 单元测试覆盖所有错误码
- [x] 集成测试验证配置切换
- [x] 性能测试验证开销

## 更新历史
- 2025-10-18: 初始版本
- 2025-10-19: 添加配置验证和文档
