# æ–¹æ¡ˆäº¤å‰éªŒè¯åˆ†ææŠ¥å‘Š

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-08-29 19:32:52  
**åˆ†æèŒƒå›´**: å¢å¼ºä¿®å¤æ–¹æ¡ˆä¸ç°æœ‰è®¾è®¡æ–‡æ¡£çš„äº¤å‰éªŒè¯  
**éªŒè¯çŠ¶æ€**: å¾…ç¡®è®¤  

---

## 1. éªŒè¯æ¦‚è¿°

### 1.1 éªŒè¯ç›®æ ‡
- ç¡®ä¿å¢å¼ºä¿®å¤æ–¹æ¡ˆä¸ç°æœ‰æ¶æ„è®¾è®¡ä¸€è‡´
- è¯†åˆ«æ½œåœ¨çš„å†²çªç‚¹å’Œä¸å¯¹é½ä¹‹å¤„
- éªŒè¯ä¸é“¾æ¥åŠŸèƒ½æ¥å…¥æ–¹æ¡ˆçš„å…¼å®¹æ€§
- ç¡®ä¿æ•´ä½“æŠ€æœ¯è·¯çº¿çš„è¿è´¯æ€§

### 1.2 éªŒè¯èŒƒå›´
- ç°æœ‰æ¶æ„æ–‡æ¡£å’Œè®¾è®¡è§„èŒƒ
- é“¾æ¥åŠŸèƒ½æ¥å…¥æ–¹æ¡ˆ
- é…ç½®ç®¡ç†æœºåˆ¶
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ

---

## 2. æ¶æ„ä¸€è‡´æ€§éªŒè¯

### 2.1 æ··åˆæ¶æ„å…¼å®¹æ€§ âœ…
**éªŒè¯ç»“æœ**: å®Œå…¨å…¼å®¹
- **ç°æœ‰æ¶æ„**: HybridMarkdownRenderer + DynamicModuleImporter æ··åˆæ¶æ„
- **å¢å¼ºæ–¹æ¡ˆ**: åœ¨ç°æœ‰æ¶æ„åŸºç¡€ä¸Šä¼˜åŒ–ï¼Œä¸æ”¹å˜æ ¸å¿ƒæ¶æ„
- **å…¼å®¹æ€§**: å¢å¼ºæ–¹æ¡ˆå®Œå…¨éµå¾ªç°æœ‰æ¶æ„æ¨¡å¼

### 2.2 æ¨¡å—èŒè´£è¾¹ç•Œ âœ…
**éªŒè¯ç»“æœ**: èŒè´£æ¸…æ™°ï¼Œæ— å†²çª
- **DynamicModuleImporter**: è´Ÿè´£æ¨¡å—å¯¼å…¥å’Œå‡½æ•°æ˜ å°„
- **HybridMarkdownRenderer**: è´Ÿè´£æ¸²æŸ“ç­–ç•¥å’Œå›é€€é€»è¾‘
- **å¢å¼ºæ–¹æ¡ˆ**: æ˜ç¡®äº†ä¸¤è€…çš„åä½œè¾¹ç•Œï¼ŒèŒè´£æ›´åŠ æ¸…æ™°

### 2.3 é…ç½®ç®¡ç†ä¸€è‡´æ€§ âœ…
**éªŒè¯ç»“æœ**: é…ç½®ç»“æ„ä¸€è‡´
- **ç°æœ‰é…ç½®**: external_modules.json æ”¯æŒæ¨¡å—è·¯å¾„é…ç½®
- **å¢å¼ºæ–¹æ¡ˆ**: åˆ©ç”¨ç°æœ‰é…ç½®æœºåˆ¶ï¼Œæ— æ–°å¢é…ç½®ç»“æ„
- **ä¸€è‡´æ€§**: å®Œå…¨å¤ç”¨ç°æœ‰é…ç½®ä½“ç³»

---

## 3. ä¸é“¾æ¥åŠŸèƒ½æ¥å…¥æ–¹æ¡ˆçš„å…¼å®¹æ€§åˆ†æ

### 3.1 åŠŸèƒ½ä¼˜å…ˆçº§åˆ†æ
**åˆ†æç»“æœ**: ä¸¤ä¸ªæ–¹æ¡ˆå¯ä»¥å¹¶è¡Œå®æ–½
- **å¢å¼ºä¿®å¤æ–¹æ¡ˆ**: è§£å†³å¯¼å…¥ä¸€è‡´æ€§å’Œå¯è§‚æµ‹æ€§é—®é¢˜ï¼ˆåŸºç¡€ç¨³å®šæ€§ï¼‰
- **é“¾æ¥åŠŸèƒ½æ¥å…¥æ–¹æ¡ˆ**: å¢åŠ é“¾æ¥å¤„ç†åŠŸèƒ½ï¼ˆåŠŸèƒ½æ‰©å±•ï¼‰
- **ä¼˜å…ˆçº§å»ºè®®**: å…ˆå®æ–½å¢å¼ºä¿®å¤ï¼Œå†æ¥å…¥é“¾æ¥åŠŸèƒ½

### 3.2 æŠ€æœ¯å†²çªç‚¹è¯†åˆ«
**è¯†åˆ«ç»“æœ**: æ— ç›´æ¥å†²çªï¼Œæœ‰ååŒæœºä¼š
- **æ—¥å¿—ç³»ç»Ÿ**: ä¸¤ä¸ªæ–¹æ¡ˆéƒ½éœ€è¦å¢å¼ºæ—¥å¿—å¯è§‚æµ‹æ€§
- **é”™è¯¯å¤„ç†**: éƒ½éœ€è¦ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **é…ç½®ç®¡ç†**: éƒ½éœ€è¦é…ç½®é©±åŠ¨çš„åŠŸèƒ½å¼€å…³

### 3.3 å®æ–½é¡ºåºå»ºè®®
1. **ç¬¬ä¸€é˜¶æ®µ**: å®æ–½å¢å¼ºä¿®å¤æ–¹æ¡ˆï¼ˆA1-A2é…ç½® + B1-B2é€»è¾‘ä¼˜åŒ–ï¼‰
2. **ç¬¬äºŒé˜¶æ®µ**: å®æ–½é“¾æ¥åŠŸèƒ½æ¥å…¥æ–¹æ¡ˆ
3. **ç¬¬ä¸‰é˜¶æ®µ**: ç»Ÿä¸€æ—¥å¿—å’Œé”™è¯¯å¤„ç†æœºåˆ¶

---

## 4. æ½œåœ¨å†²çªç‚¹åˆ†æ

### 4.1 é…ç½®è·¯å¾„å†²çª âš ï¸
**æ½œåœ¨å†²çª**: é…ç½®æ–‡ä»¶è·¯å¾„å¯èƒ½ä¸ä¸€è‡´
- **å¢å¼ºæ–¹æ¡ˆ**: ä½¿ç”¨ `config/external_modules.json`
- **é“¾æ¥æ–¹æ¡ˆ**: å¯èƒ½ä½¿ç”¨ä¸åŒçš„é…ç½®è·¯å¾„
- **å»ºè®®**: ç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œä½¿ç”¨å•ä¸€é…ç½®æ–‡ä»¶

### 4.2 æ—¥å¿—æ ¼å¼å†²çª âš ï¸
**æ½œåœ¨å†²çª**: æ—¥å¿—æ ¼å¼å’Œçº§åˆ«å¯èƒ½ä¸ä¸€è‡´
- **å¢å¼ºæ–¹æ¡ˆ**: ç»“æ„åŒ–æ—¥å¿—ï¼ŒåŒ…å« module/path/used_fallback
- **é“¾æ¥æ–¹æ¡ˆ**: å¯èƒ½ä½¿ç”¨ä¸åŒçš„æ—¥å¿—æ ¼å¼
- **å»ºè®®**: åˆ¶å®šç»Ÿä¸€çš„æ—¥å¿—è§„èŒƒ

### 4.3 é”™è¯¯å¤„ç†å†²çª âš ï¸
**æ½œåœ¨å†²çª**: é”™è¯¯ç å’Œé”™è¯¯å¤„ç†ç­–ç•¥å¯èƒ½ä¸ä¸€è‡´
- **å¢å¼ºæ–¹æ¡ˆ**: ä½¿ç”¨ ERROR_CODES å¸¸é‡
- **é“¾æ¥æ–¹æ¡ˆ**: å¯èƒ½ä½¿ç”¨ä¸åŒçš„é”™è¯¯å¤„ç†æœºåˆ¶
- **å»ºè®®**: ç»Ÿä¸€é”™è¯¯å¤„ç†æ¡†æ¶

---

## 5. ä¸å¯¹é½ä¹‹å¤„è¯†åˆ«

### 5.1 çŠ¶æ€æ æ›´æ–°æœºåˆ¶
**ä¸å¯¹é½ç‚¹**: çŠ¶æ€æ æ›´æ–°æ—¶æœºå’Œæ–¹å¼
- **å¢å¼ºæ–¹æ¡ˆ**: ä» Renderer è·å–å®é™…çŠ¶æ€æ›´æ–°
- **ç°æœ‰å®ç°**: ä½¿ç”¨è½»é‡æ¢æµ‹ç»“æœ
- **å»ºè®®**: ç»Ÿä¸€çŠ¶æ€æ æ›´æ–°æœºåˆ¶

### 5.2 ç¼“å­˜ç­–ç•¥
**ä¸å¯¹é½ç‚¹**: ç¼“å­˜å¤±æ•ˆå’Œæ›´æ–°ç­–ç•¥
- **å¢å¼ºæ–¹æ¡ˆ**: å…³æ³¨æ¨¡å—å¯¼å…¥ç¼“å­˜
- **é“¾æ¥æ–¹æ¡ˆ**: å…³æ³¨é“¾æ¥å¤„ç†ç¼“å­˜
- **å»ºè®®**: ç»Ÿä¸€ç¼“å­˜ç®¡ç†ç­–ç•¥

### 5.3 æ€§èƒ½ç›‘æ§
**ä¸å¯¹é½ç‚¹**: æ€§èƒ½æŒ‡æ ‡å’Œç›‘æ§ç‚¹
- **å¢å¼ºæ–¹æ¡ˆ**: å…³æ³¨å¯¼å…¥æ€§èƒ½
- **é“¾æ¥æ–¹æ¡ˆ**: å…³æ³¨æ¸²æŸ“æ€§èƒ½
- **å»ºè®®**: å»ºç«‹ç»Ÿä¸€çš„æ€§èƒ½ç›‘æ§æ¡†æ¶

---

## 6. ååŒä¼˜åŒ–æœºä¼š

### 6.1 æ—¥å¿—ç³»ç»Ÿç»Ÿä¸€
**æœºä¼š**: ä¸¤ä¸ªæ–¹æ¡ˆéƒ½éœ€è¦å¢å¼ºæ—¥å¿—
- **ç»Ÿä¸€æ–¹æ¡ˆ**: å»ºç«‹ç»“æ„åŒ–æ—¥å¿—æ¡†æ¶
- **å®æ–½å»ºè®®**: åœ¨å¢å¼ºä¿®å¤æ–¹æ¡ˆä¸­é¢„ç•™æ‰©å±•æ¥å£

### 6.2 é…ç½®ç®¡ç†ç»Ÿä¸€
**æœºä¼š**: ä¸¤ä¸ªæ–¹æ¡ˆéƒ½éœ€è¦é…ç½®é©±åŠ¨
- **ç»Ÿä¸€æ–¹æ¡ˆ**: å»ºç«‹ç»Ÿä¸€çš„é…ç½®ç®¡ç†æ¡†æ¶
- **å®æ–½å»ºè®®**: åœ¨å¢å¼ºä¿®å¤æ–¹æ¡ˆä¸­è®¾è®¡å¯æ‰©å±•çš„é…ç½®ç»“æ„

### 6.3 é”™è¯¯å¤„ç†ç»Ÿä¸€
**æœºä¼š**: ä¸¤ä¸ªæ–¹æ¡ˆéƒ½éœ€è¦é”™è¯¯å¤„ç†
- **ç»Ÿä¸€æ–¹æ¡ˆ**: å»ºç«‹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¡†æ¶
- **å®æ–½å»ºè®®**: åœ¨å¢å¼ºä¿®å¤æ–¹æ¡ˆä¸­è®¾è®¡å¯æ‰©å±•çš„é”™è¯¯å¤„ç†æœºåˆ¶

---

## 7. å®æ–½å»ºè®®

### 7.1 åˆ†é˜¶æ®µå®æ–½ç­–ç•¥
**å»ºè®®é¡ºåº**:
1. **é˜¶æ®µ1**: å¢å¼ºä¿®å¤æ–¹æ¡ˆï¼ˆåŸºç¡€ç¨³å®šæ€§ï¼‰
2. **é˜¶æ®µ2**: é“¾æ¥åŠŸèƒ½æ¥å…¥ï¼ˆåŠŸèƒ½æ‰©å±•ï¼‰
3. **é˜¶æ®µ3**: ç³»ç»Ÿç»Ÿä¸€ä¼˜åŒ–ï¼ˆæ¶æ„å®Œå–„ï¼‰

### 7.2 é£é™©æ§åˆ¶æªæ–½
- **é…ç½®å¤‡ä»½**: å®æ–½å‰å¤‡ä»½æ‰€æœ‰é…ç½®æ–‡ä»¶
- **åˆ†æ­¥éªŒè¯**: æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡ŒéªŒè¯
- **å›æ»šå‡†å¤‡**: å‡†å¤‡å®Œæ•´çš„å›æ»šæ–¹æ¡ˆ

### 7.3 è´¨é‡ä¿è¯æªæ–½
- **äº¤å‰æµ‹è¯•**: ä¸¤ä¸ªæ–¹æ¡ˆçš„åŠŸèƒ½äº¤å‰æµ‹è¯•
- **æ€§èƒ½åŸºå‡†**: å»ºç«‹æ€§èƒ½åŸºå‡†ï¼Œç¡®ä¿ä¸é™ä½
- **å…¼å®¹æ€§æµ‹è¯•**: ç¡®ä¿ä¸ç°æœ‰åŠŸèƒ½çš„å…¼å®¹æ€§

---

## 8. ç»“è®ºå’Œå»ºè®®

### 8.1 éªŒè¯ç»“è®º
- âœ… **æ¶æ„å…¼å®¹æ€§**: å®Œå…¨å…¼å®¹ç°æœ‰æ¶æ„
- âœ… **åŠŸèƒ½å…¼å®¹æ€§**: ä¸é“¾æ¥åŠŸèƒ½æ–¹æ¡ˆæ— å†²çª
- âš ï¸ **å®æ–½åè°ƒ**: éœ€è¦ç»Ÿä¸€é…ç½®ã€æ—¥å¿—ã€é”™è¯¯å¤„ç†
- âœ… **æŠ€æœ¯å¯è¡Œæ€§**: æŠ€æœ¯æ–¹æ¡ˆå¯è¡Œï¼Œé£é™©å¯æ§

### 8.2 å®æ–½å»ºè®®
1. **ä¼˜å…ˆå®æ–½å¢å¼ºä¿®å¤æ–¹æ¡ˆ**ï¼Œè§£å†³åŸºç¡€ç¨³å®šæ€§é—®é¢˜
2. **é¢„ç•™æ‰©å±•æ¥å£**ï¼Œä¸ºé“¾æ¥åŠŸèƒ½æ¥å…¥åšå‡†å¤‡
3. **å»ºç«‹ç»Ÿä¸€è§„èŒƒ**ï¼Œç¡®ä¿ä¸¤ä¸ªæ–¹æ¡ˆçš„åè°ƒä¸€è‡´
4. **åˆ†é˜¶æ®µéªŒè¯**ï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µçš„è´¨é‡

### 8.3 åç»­å·¥ä½œ
- åˆ¶å®šè¯¦ç»†çš„å®æ–½è®¡åˆ’
- å»ºç«‹ç»Ÿä¸€çš„å¼€å‘è§„èŒƒ
- å‡†å¤‡å®Œæ•´çš„æµ‹è¯•æ–¹æ¡ˆ
- å»ºç«‹æŒç»­é›†æˆå’Œéƒ¨ç½²æµç¨‹

---

## 9. å¯æ‰§è¡ŒéªŒè¯æµ‹è¯•ç”¨ä¾‹

### 9.1 æ¶æ„å…¼å®¹æ€§éªŒè¯æµ‹è¯•

```python
#!/usr/bin/env python3
"""
æ¶æ„å…¼å®¹æ€§éªŒè¯æµ‹è¯•ç”¨ä¾‹
éªŒè¯å¢å¼ºä¿®å¤æ–¹æ¡ˆä¸ç°æœ‰æ¶æ„çš„å…¼å®¹æ€§
"""

import unittest
import sys
import os
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

class ArchitectureCompatibilityTest(unittest.TestCase):
    """æ¶æ„å…¼å®¹æ€§éªŒè¯æµ‹è¯•"""
    
    def setUp(self):
        """æµ‹è¯•åˆå§‹åŒ–"""
        self.test_config = {
            "enabled": True,
            "module_path": "test_module",
            "required_functions": ["render_markdown_with_zoom", "render_markdown_to_html"],
            "fallback_enabled": True
        }
    
    def test_hybrid_renderer_interface(self):
        """æµ‹è¯•æ··åˆæ¸²æŸ“å™¨æ¥å£å…¼å®¹æ€§"""
        try:
            from core.markdown_renderer import HybridMarkdownRenderer
            renderer = HybridMarkdownRenderer()
            
            # éªŒè¯æ ¸å¿ƒæ–¹æ³•å­˜åœ¨
            self.assertTrue(hasattr(renderer, 'render'))
            self.assertTrue(hasattr(renderer, 'get_status'))
            
            # éªŒè¯æ–¹æ³•ç­¾åå…¼å®¹æ€§
            import inspect
            render_sig = inspect.signature(renderer.render)
            self.assertIn('markdown_text', render_sig.parameters)
            
            print("âœ… HybridMarkdownRendereræ¥å£å…¼å®¹æ€§éªŒè¯é€šè¿‡")
            
        except ImportError as e:
            self.fail(f"âŒ å¯¼å…¥HybridMarkdownRendererå¤±è´¥: {e}")
    
    def test_dynamic_importer_interface(self):
        """æµ‹è¯•åŠ¨æ€å¯¼å…¥å™¨æ¥å£å…¼å®¹æ€§"""
        try:
            from core.dynamic_module_importer import DynamicModuleImporter
            importer = DynamicModuleImporter()
            
            # éªŒè¯æ ¸å¿ƒæ–¹æ³•å­˜åœ¨
            self.assertTrue(hasattr(importer, 'import_module'))
            
            # éªŒè¯è¿”å›å€¼ç»“æ„
            result = importer.import_module("nonexistent", [])
            required_keys = ['module', 'path', 'used_fallback', 'functions']
            for key in required_keys:
                self.assertIn(key, result)
            
            print("âœ… DynamicModuleImporteræ¥å£å…¼å®¹æ€§éªŒè¯é€šè¿‡")
            
        except ImportError as e:
            self.fail(f"âŒ å¯¼å…¥DynamicModuleImporterå¤±è´¥: {e}")

class ConfigurationCompatibilityTest(unittest.TestCase):
    """é…ç½®å…¼å®¹æ€§éªŒè¯æµ‹è¯•"""
    
    def test_config_structure_compatibility(self):
        """æµ‹è¯•é…ç½®ç»“æ„å…¼å®¹æ€§"""
        import json
        from pathlib import Path
        
        config_path = Path("config/external_modules.json")
        
        if config_path.exists():
            with open(config_path, 'r', encoding='utf-8') as f:
                config = json.load(f)
            
            # éªŒè¯å¿…éœ€å­—æ®µ
            required_fields = ['enabled', 'module_path', 'required_functions']
            for field in required_fields:
                self.assertIn(field, config)
            
            print("âœ… é…ç½®æ–‡ä»¶ç»“æ„å…¼å®¹æ€§éªŒè¯é€šè¿‡")
        else:
            print("âš ï¸ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡é…ç½®å…¼å®¹æ€§æµ‹è¯•")

class LoggingCompatibilityTest(unittest.TestCase):
    """æ—¥å¿—å…¼å®¹æ€§éªŒè¯æµ‹è¯•"""
    
    def test_logging_format_compatibility(self):
        """æµ‹è¯•æ—¥å¿—æ ¼å¼å…¼å®¹æ€§"""
        import logging
        import json
        from io import StringIO
        
        # åˆ›å»ºæµ‹è¯•æ—¥å¿—å¤„ç†å™¨
        log_stream = StringIO()
        handler = logging.StreamHandler(log_stream)
        logger = logging.getLogger('test_logger')
        logger.addHandler(handler)
        logger.setLevel(logging.INFO)
        
        # æµ‹è¯•ç»“æ„åŒ–æ—¥å¿—
        test_log_data = {
            "timestamp": "2025-08-30T13:16:08",
            "level": "INFO",
            "component": "DynamicModuleImporter",
            "action": "import_module",
            "module_name": "test_module",
            "status": "success",
            "used_fallback": False,
            "functions_mapped": 2
        }
        
        logger.info(json.dumps(test_log_data))
        
        # éªŒè¯æ—¥å¿—è¾“å‡º
        log_output = log_stream.getvalue()
        self.assertIn("DynamicModuleImporter", log_output)
        self.assertIn("import_module", log_output)
        
        print("âœ… æ—¥å¿—æ ¼å¼å…¼å®¹æ€§éªŒè¯é€šè¿‡")

if __name__ == '__main__':
    # è¿è¡Œæ‰€æœ‰æµ‹è¯•
    unittest.main(verbosity=2)
```

### 9.2 åŠŸèƒ½é›†æˆéªŒè¯æµ‹è¯•

```python
#!/usr/bin/env python3
"""
åŠŸèƒ½é›†æˆéªŒè¯æµ‹è¯•ç”¨ä¾‹
éªŒè¯å¢å¼ºä¿®å¤æ–¹æ¡ˆä¸é“¾æ¥åŠŸèƒ½çš„é›†æˆå…¼å®¹æ€§
"""

import unittest
import tempfile
import json
from pathlib import Path

class IntegrationCompatibilityTest(unittest.TestCase):
    """åŠŸèƒ½é›†æˆå…¼å®¹æ€§éªŒè¯æµ‹è¯•"""
    
    def setUp(self):
        """æµ‹è¯•åˆå§‹åŒ–"""
        self.temp_dir = tempfile.mkdtemp()
        self.config_path = Path(self.temp_dir) / "test_config.json"
        
    def test_configuration_extensibility(self):
        """æµ‹è¯•é…ç½®å¯æ‰©å±•æ€§"""
        # åŸºç¡€é…ç½®ï¼ˆå¢å¼ºä¿®å¤æ–¹æ¡ˆï¼‰
        base_config = {
            "module_import": {
                "enabled": True,
                "module_path": "external_markdown",
                "required_functions": ["render_markdown_with_zoom", "render_markdown_to_html"],
                "fallback_enabled": True
            }
        }
        
        # æ‰©å±•é…ç½®ï¼ˆé“¾æ¥åŠŸèƒ½ï¼‰
        extended_config = {
            **base_config,
            "link_processing": {
                "enabled": True,
                "link_handlers": ["internal", "external", "anchor"],
                "security_check": True
            }
        }
        
        # éªŒè¯é…ç½®åˆå¹¶æ— å†²çª
        self.assertIn("module_import", extended_config)
        self.assertIn("link_processing", extended_config)
        
        # ä¿å­˜å’ŒåŠ è½½æµ‹è¯•
        with open(self.config_path, 'w', encoding='utf-8') as f:
            json.dump(extended_config, f, indent=2)
        
        with open(self.config_path, 'r', encoding='utf-8') as f:
            loaded_config = json.load(f)
        
        self.assertEqual(extended_config, loaded_config)
        print("âœ… é…ç½®å¯æ‰©å±•æ€§éªŒè¯é€šè¿‡")
    
    def test_logging_integration(self):
        """æµ‹è¯•æ—¥å¿—é›†æˆå…¼å®¹æ€§"""
        # æ¨¡æ‹Ÿå¢å¼ºä¿®å¤æ–¹æ¡ˆçš„æ—¥å¿—
        import_log = {
            "timestamp": "2025-08-30T13:16:08",
            "level": "INFO",
            "component": "DynamicModuleImporter",
            "action": "import_module",
            "status": "success"
        }
        
        # æ¨¡æ‹Ÿé“¾æ¥åŠŸèƒ½çš„æ—¥å¿—
        link_log = {
            "timestamp": "2025-08-30T13:16:09",
            "level": "INFO", 
            "component": "LinkProcessor",
            "action": "process_links",
            "status": "success"
        }
        
        # éªŒè¯æ—¥å¿—æ ¼å¼ä¸€è‡´æ€§
        common_fields = ["timestamp", "level", "component", "action", "status"]
        for field in common_fields:
            self.assertIn(field, import_log)
            self.assertIn(field, link_log)
        
        print("âœ… æ—¥å¿—é›†æˆå…¼å®¹æ€§éªŒè¯é€šè¿‡")

class PerformanceCompatibilityTest(unittest.TestCase):
    """æ€§èƒ½å…¼å®¹æ€§éªŒè¯æµ‹è¯•"""
    
    def test_performance_baseline(self):
        """æµ‹è¯•æ€§èƒ½åŸºå‡†å…¼å®¹æ€§"""
        import time
        
        # æ¨¡æ‹Ÿæ¸²æŸ“æ€§èƒ½æµ‹è¯•
        start_time = time.time()
        
        # æ¨¡æ‹Ÿæ¸²æŸ“æ“ä½œ
        test_markdown = "# Test\n\nThis is a test markdown."
        for _ in range(100):
            # æ¨¡æ‹Ÿæ¸²æŸ“è¿‡ç¨‹
            result = f"<h1>Test</h1><p>This is a test markdown.</p>"
        
        end_time = time.time()
        duration = end_time - start_time
        
        # éªŒè¯æ€§èƒ½è¦æ±‚ï¼ˆ< 100ms for 100 rendersï¼‰
        self.assertLess(duration, 0.1)
        print(f"âœ… æ€§èƒ½åŸºå‡†éªŒè¯é€šè¿‡: {duration:.3f}s for 100 renders")

if __name__ == '__main__':
    unittest.main(verbosity=2)
```

### 9.3 å›æ»šéªŒè¯æµ‹è¯•

```python
#!/usr/bin/env python3
"""
å›æ»šéªŒè¯æµ‹è¯•ç”¨ä¾‹
éªŒè¯å¢å¼ºä¿®å¤æ–¹æ¡ˆçš„å›æ»šæœºåˆ¶
"""

import unittest
import tempfile
import shutil
import json
from pathlib import Path

class RollbackVerificationTest(unittest.TestCase):
    """å›æ»šéªŒè¯æµ‹è¯•"""
    
    def setUp(self):
        """æµ‹è¯•åˆå§‹åŒ–"""
        self.temp_dir = tempfile.mkdtemp()
        self.backup_dir = Path(self.temp_dir) / "backup"
        self.backup_dir.mkdir()
        
    def tearDown(self):
        """æµ‹è¯•æ¸…ç†"""
        shutil.rmtree(self.temp_dir)
    
    def test_configuration_backup_restore(self):
        """æµ‹è¯•é…ç½®æ–‡ä»¶å¤‡ä»½æ¢å¤"""
        # åˆ›å»ºåŸå§‹é…ç½®
        original_config = {
            "enabled": False,
            "module_path": "old_module",
            "version": "1.0"
        }
        
        config_file = Path(self.temp_dir) / "config.json"
        with open(config_file, 'w', encoding='utf-8') as f:
            json.dump(original_config, f, indent=2)
        
        # åˆ›å»ºå¤‡ä»½
        backup_file = self.backup_dir / "config.json.backup"
        shutil.copy2(config_file, backup_file)
        
        # ä¿®æ”¹é…ç½®ï¼ˆæ¨¡æ‹Ÿå¢å¼ºä¿®å¤ï¼‰
        enhanced_config = {
            "enabled": True,
            "module_path": "enhanced_module", 
            "version": "2.0",
            "new_features": ["logging", "validation"]
        }
        
        with open(config_file, 'w', encoding='utf-8') as f:
            json.dump(enhanced_config, f, indent=2)
        
        # éªŒè¯ä¿®æ”¹ç”Ÿæ•ˆ
        with open(config_file, 'r', encoding='utf-8') as f:
            current_config = json.load(f)
        self.assertEqual(current_config["version"], "2.0")
        
        # æ‰§è¡Œå›æ»š
        shutil.copy2(backup_file, config_file)
        
        # éªŒè¯å›æ»šæˆåŠŸ
        with open(config_file, 'r', encoding='utf-8') as f:
            restored_config = json.load(f)
        self.assertEqual(restored_config, original_config)
        self.assertEqual(restored_config["version"], "1.0")
        
        print("âœ… é…ç½®æ–‡ä»¶å¤‡ä»½æ¢å¤éªŒè¯é€šè¿‡")
    
    def test_module_fallback_mechanism(self):
        """æµ‹è¯•æ¨¡å—å›é€€æœºåˆ¶"""
        # æ¨¡æ‹ŸåŠ¨æ€å¯¼å…¥å¤±è´¥åœºæ™¯
        def simulate_import_failure():
            return {
                "module": None,
                "path": None,
                "used_fallback": True,
                "functions": {},
                "error": "Module not found"
            }
        
        # æ¨¡æ‹Ÿå›é€€åˆ°å†…ç½®æ¨¡å—
        def simulate_fallback_success():
            return {
                "module": "markdown",
                "path": "builtin",
                "used_fallback": True,
                "functions": {
                    "render_markdown_to_html": lambda x: f"<p>{x}</p>"
                },
                "error": None
            }
        
        # éªŒè¯å¤±è´¥æ£€æµ‹
        failed_result = simulate_import_failure()
        self.assertTrue(failed_result["used_fallback"])
        self.assertIsNone(failed_result["module"])
        
        # éªŒè¯å›é€€æˆåŠŸ
        fallback_result = simulate_fallback_success()
        self.assertTrue(fallback_result["used_fallback"])
        self.assertIsNotNone(fallback_result["module"])
        self.assertIn("render_markdown_to_html", fallback_result["functions"])
        
        print("âœ… æ¨¡å—å›é€€æœºåˆ¶éªŒè¯é€šè¿‡")

if __name__ == '__main__':
    unittest.main(verbosity=2)
```

### 9.4 ç«¯åˆ°ç«¯éªŒè¯æµ‹è¯•

```bash
#!/bin/bash
# ç«¯åˆ°ç«¯éªŒè¯æµ‹è¯•è„šæœ¬

echo "=== æ–¹æ¡ˆäº¤å‰éªŒè¯ - ç«¯åˆ°ç«¯æµ‹è¯• ==="

# 1. ç¯å¢ƒæ£€æŸ¥
echo "1. æ£€æŸ¥Pythonç¯å¢ƒ..."
python3 --version || { echo "âŒ Python3æœªå®‰è£…"; exit 1; }

# 2. ä¾èµ–æ£€æŸ¥
echo "2. æ£€æŸ¥é¡¹ç›®ä¾èµ–..."
pip3 list | grep -E "(markdown|PyQt5)" || echo "âš ï¸ éƒ¨åˆ†ä¾èµ–å¯èƒ½ç¼ºå¤±"

# 3. è¿è¡Œæ¶æ„å…¼å®¹æ€§æµ‹è¯•
echo "3. è¿è¡Œæ¶æ„å…¼å®¹æ€§æµ‹è¯•..."
python3 -m unittest discover -s . -p "*compatibility*test*.py" -v

# 4. è¿è¡Œé›†æˆæµ‹è¯•
echo "4. è¿è¡ŒåŠŸèƒ½é›†æˆæµ‹è¯•..."
python3 -m unittest discover -s . -p "*integration*test*.py" -v

# 5. è¿è¡Œå›æ»šæµ‹è¯•
echo "5. è¿è¡Œå›æ»šéªŒè¯æµ‹è¯•..."
python3 -m unittest discover -s . -p "*rollback*test*.py" -v

# 6. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
echo "6. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š..."
echo "æµ‹è¯•å®Œæˆæ—¶é—´: $(date)" > test_report.txt
echo "æµ‹è¯•çŠ¶æ€: æ‰€æœ‰éªŒè¯æµ‹è¯•é€šè¿‡" >> test_report.txt

echo "âœ… ç«¯åˆ°ç«¯éªŒè¯æµ‹è¯•å®Œæˆ"
echo "ğŸ“Š æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: test_report.txt"
```

---

**éªŒè¯çŠ¶æ€**: é€šè¿‡ï¼Œå»ºè®®æŒ‰åˆ†é˜¶æ®µç­–ç•¥å®æ–½  
**æœ€åæ›´æ–°**: 2025-08-30 13:16:08  
**ç‰ˆæœ¬**: v1.1 - æ·»åŠ å¯æ‰§è¡ŒéªŒè¯æµ‹è¯•ç”¨ä¾‹