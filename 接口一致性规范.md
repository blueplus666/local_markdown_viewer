# 接口一致性规范

## 1. 目的
为保证本地Markdown文件渲染程序各核心组件协作一致、便于维护和扩展，统一所有涉及缓存统计的组件接口规范。

## 2. 适用范围
- ContentViewer
- MarkdownRenderer
- ContentPreview
- 未来所有涉及缓存统计的核心组件

## 3. 统一接口规范
所有涉及缓存统计的组件，必须实现如下接口：

```python
def get_cache_info(self) -> dict:
    """获取缓存信息，返回结构如下：
    {
        'total': 当前缓存条目数（int）, 
        'limit': 缓存上限（int）, 
        ...  # 其他可选字段
    }
    """
    ...
```
- 兼容保留原有字段（如'total_items'、'cache_size'），但主窗口和所有新代码只依赖统一字段。
- 无缓存时，返回{'total': 0, 'limit': 0}。

## 4. 示例

### ContentViewer
```python
def get_cache_info(self) -> dict:
    return {
        'total': len(self.content_cache),
        'limit': self.cache_limit,
        'total_items': len(self.content_cache),  # 兼容旧字段
        'cache_limit': self.cache_limit,         # 兼容旧字段
        'cached_files': list(self.content_cache.keys())
    }
```

### MarkdownRenderer
```python
def get_cache_info(self) -> dict:
    return {
        'total': len(self._render_cache),
        'limit': self._cache_max_size,
        'cache_size': len(self._render_cache),  # 兼容旧字段
        'max_size': self._cache_max_size,        # 兼容旧字段
        'cache_keys': list(self._render_cache.keys())
    }
```

### ContentPreview
```python
def get_cache_info(self) -> dict:
    return {
        'total': 0,
        'limit': 0
    }
```

## 5. 变更与维护
- 本规范为强制性接口规范，所有新开发和重构组件必须遵循。
- 如需扩展字段，需保证'总数'和'上限'字段命名不变。
- 变更需同步更新本文件和相关开发文档。