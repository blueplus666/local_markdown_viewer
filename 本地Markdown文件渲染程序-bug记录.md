## Bug编号：20250806-001
### 标题：性能监控KeyError: 'total'（统一缓存统计接口方案B）

#### 来源
集成主窗口的性能监控与缓存信息展示功能。

#### 产生原因
主窗口假定所有组件的get_cache_info()都返回'total'和'limit'字段，实际各组件返回结构不一致（如ContentViewer返回'total_items'，MarkdownRenderer返回'cache_size'），导致KeyError。

#### 影响范围
主窗口性能监控、性能信息弹窗、日志刷屏，影响用户体验和调试。

#### 分析过程
1. 检查主窗口性能监控代码，发现直接访问'total'字段。
2. 检查ContentViewer、MarkdownRenderer等组件的get_cache_info()，发现字段名不统一。
3. 运行时出现KeyError，导致性能监控失败。

#### 修正方案（方案B：接口统一）
- 统一所有涉及缓存统计的组件（如ContentViewer、MarkdownRenderer等）的get_cache_info()接口，返回结构为：
  ```python
  {
      'total': 当前缓存条目数（int）, 
      'limit': 缓存上限（int）, 
      ...  # 其他可选字段
  }
  ```
- 兼容保留原有字段（如'total_items'、'cache_size'），但主窗口和所有新代码只依赖统一字段。
- 主窗口性能监控、性能信息展示等所有相关代码全部切换为访问'total'和'limit'字段。
- 更新开发文档和接口文档，明确接口规范。

#### 优缺点
- 优点：
  - 所有组件接口一致，长期维护和扩展更方便。
  - 性能监控和UI展示代码更简洁、健壮。
  - 有利于团队协作和自动化测试。
- 缺点：
  - 需要批量修改多个组件和相关测试代码，短期内工作量略大。
  - 需团队成员协同，避免遗漏。

#### 结论
采用方案B，统一所有缓存统计接口，提升系统一致性和可维护性。

#### 修正人
AI助手

#### 修正日期
2025-08-06