# æ–¹æ¡ˆ2-æ··åˆæ¶æ„-å®æ–½æŠ¥å‘Š

## 1. å®æ–½æ¦‚è¿°

### ç›®æ ‡
åœ¨ä¸ç ´åç°æœ‰åŠŸèƒ½ä¸å‘åå…¼å®¹çš„å‰æä¸‹ï¼Œä¸ºæœ¬åœ° Markdown æ¸²æŸ“ç¨‹åºå¼•å…¥"åŠ¨æ€å¯¼å…¥ + ç»Ÿä¸€è·¯å¾„è§£æ"çš„æ··åˆæ–¹æ¡ˆã€‚

### èŒƒå›´
- æ–°å¢ `DynamicModuleImporter` æ¨¡å—
- æ”¹é€ ç°æœ‰ `MarkdownRenderer` ä¸º `HybridMarkdownRenderer`
- æ›´æ–°é…ç½®æ–‡ä»¶ä»¥æ”¯æŒæ··åˆæ¶æ„
- ä¿æŒå‘åå…¼å®¹æ€§

### å˜æ›´ç‚¹
1. **æ ¸å¿ƒç»„ä»¶**ï¼šæ–°å¢åŠ¨æ€æ¨¡å—å¯¼å…¥å™¨ï¼Œæ”¯æŒç¼“å­˜ã€fallbackå’Œé”™è¯¯å¤„ç†
2. **æ¸²æŸ“æ¶æ„**ï¼šå®ç°ä¸‰ä¼˜å…ˆçº§æ¸²æŸ“é“¾ï¼ˆåŠ¨æ€å¯¼å…¥ â†’ æ ‡å‡†åº“ â†’ æ–‡æœ¬é™çº§ï¼‰
3. **é…ç½®ç®¡ç†**ï¼šæ–°å¢ `use_dynamic_import` ç­‰é…ç½®é¡¹
4. **å‘åå…¼å®¹**ï¼šä¿ç•™ `MarkdownRenderer` ä½œä¸º `HybridMarkdownRenderer` çš„åˆ«å

## 2. æ–‡ä»¶æ”¹åŠ¨æ¸…å•

### æ–°å¢æ–‡ä»¶
- **`core/dynamic_module_importer.py`** (482è¡Œ)
  - å®ç°åŠ¨æ€æ¨¡å—å¯¼å…¥åŠŸèƒ½
  - æ”¯æŒç¼“å­˜ã€fallbackå’Œé”™è¯¯å¤„ç†
  - æä¾›å¯è§‚æµ‹çŠ¶æ€æŸ¥è¯¢
  - ä¸´æ—¶ `sys.path` ä¸Šä¸‹æ–‡ç®¡ç†

### ä¿®æ”¹æ–‡ä»¶
- **`core/markdown_renderer.py`** (482è¡Œ)
  - ç±»åï¼š`MarkdownRenderer` â†’ `HybridMarkdownRenderer`
  - é›†æˆ `DynamicModuleImporter`
  - å®ç°ä¸‰ä¼˜å…ˆçº§æ¸²æŸ“é“¾
  - æ–°å¢ `use_dynamic_import` é…ç½®æ”¯æŒ
  - å‘åå…¼å®¹ï¼š`MarkdownRenderer = HybridMarkdownRenderer`

- **`config/app_config.json`**
  - æ–°å¢ `external_modules.markdown_processor.priority` å­—æ®µ
  - ç§»é™¤ `markdown.module_path` å­—æ®µï¼ˆå–æ¶ˆåå¤‡è·¯å¾„ï¼‰
  - æ–°å¢ `markdown.use_dynamic_import` å­—æ®µ

### æ–°å¢é…ç½®ç¤ºä¾‹
- **`config/app_config.sample.json`** (61è¡Œ)
  - æ··åˆæ¶æ„é…ç½®ç¤ºä¾‹
  - åŒ…å«æ‰€æœ‰æ–°é…ç½®é¡¹çš„è¯´æ˜

## 3. å‘åå…¼å®¹æ€§éªŒè¯

### âœ… å®Œå…¨å…¼å®¹
1. **ç±»åå…¼å®¹**ï¼š`MarkdownRenderer` ä½œä¸º `HybridMarkdownRenderer` çš„åˆ«å
2. **æ¥å£å…¼å®¹**ï¼šæ‰€æœ‰ç°æœ‰æ–¹æ³•ç­¾åä¿æŒä¸å˜
3. **é…ç½®å…¼å®¹**ï¼šç°æœ‰é…ç½®é¡¹ç»§ç»­æœ‰æ•ˆ
4. **åŠŸèƒ½å…¼å®¹**ï¼šç°æœ‰åŠŸèƒ½å®Œå…¨ä¿ç•™

### ğŸ”„ æ¸è¿›å¢å¼º
1. **åŠ¨æ€å¯¼å…¥**ï¼šé€šè¿‡ `use_dynamic_import` å¼€å…³æ§åˆ¶
2. **æ¸²æŸ“ä¼˜å…ˆçº§**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¸²æŸ“å™¨
3. **é”™è¯¯å¤„ç†**ï¼šä¼˜é›…é™çº§ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

### ğŸ“Š å…¼å®¹æ€§æµ‹è¯•å»ºè®®
```python
# æµ‹è¯•ç°æœ‰ä»£ç æ˜¯å¦æ­£å¸¸å·¥ä½œ
from core.markdown_renderer import MarkdownRenderer  # åº”è¯¥ä»ç„¶å¯ç”¨
renderer = MarkdownRenderer()
result = renderer.render("# Hello World")

# æµ‹è¯•æ–°åŠŸèƒ½
from core.markdown_renderer import HybridMarkdownRenderer
hybrid_renderer = HybridMarkdownRenderer()
features = hybrid_renderer.get_supported_features()
print(f"åŠ¨æ€å¯¼å…¥æ”¯æŒ: {features.get('dynamic_module_import', False)}")
```

## 4. æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
1. **åŠ¨æ€å¯¼å…¥æµ‹è¯•**
   ```python
   # æµ‹è¯•åŠ¨æ€æ¨¡å—å¯¼å…¥
   from core.dynamic_module_importer import DynamicModuleImporter
   importer = DynamicModuleImporter()
   result = importer.import_module('markdown_processor', ['markdown'])
   print(f"å¯¼å…¥ç»“æœ: {result['success']}")
   ```

2. **æ¸²æŸ“ä¼˜å…ˆçº§æµ‹è¯•**
   ```python
   # æµ‹è¯•æ¸²æŸ“ä¼˜å…ˆçº§
   renderer = HybridMarkdownRenderer()
   result = renderer.render("# Test")
   print(f"ä½¿ç”¨çš„æ¸²æŸ“å™¨: {result['renderer']}")
   ```

3. **é…ç½®æµ‹è¯•**
   ```python
   # æµ‹è¯•é…ç½®åŠ è½½
   from utils.config_manager import ConfigManager
   config = ConfigManager()
   use_dynamic = config.get('markdown', {}).get('use_dynamic_import', True)
   print(f"åŠ¨æ€å¯¼å…¥å¯ç”¨: {use_dynamic}")
   ```

### æ€§èƒ½æµ‹è¯•
1. **ç¼“å­˜æ•ˆæœæµ‹è¯•**
   ```python
   # æµ‹è¯•ç¼“å­˜æ€§èƒ½
   import time
   renderer = HybridMarkdownRenderer()
   
   # ç¬¬ä¸€æ¬¡æ¸²æŸ“
   start = time.time()
   result1 = renderer.render("# Test")
   time1 = time.time() - start
   
   # ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼ˆåº”è¯¥ä½¿ç”¨ç¼“å­˜ï¼‰
   start = time.time()
   result2 = renderer.render("# Test")
   time2 = time.time() - start
   
   print(f"é¦–æ¬¡æ¸²æŸ“: {time1:.3f}s, ç¼“å­˜æ¸²æŸ“: {time2:.3f}s")
   ```

2. **å¯¼å…¥çŠ¶æ€ç›‘æ§**
   ```python
   # æµ‹è¯•å¯¼å…¥çŠ¶æ€
   importer = DynamicModuleImporter()
   status = importer.get_import_status()
   print(f"å¯¼å…¥ç»Ÿè®¡: {status}")
   ```

### é”™è¯¯å¤„ç†æµ‹è¯•
1. **æ¨¡å—ä¸å­˜åœ¨æµ‹è¯•**
   ```python
   # æµ‹è¯•æ¨¡å—ä¸å­˜åœ¨çš„æƒ…å†µ
   importer = DynamicModuleImporter()
   result = importer.import_module('nonexistent_module')
   print(f"é”™è¯¯å¤„ç†: {result['error_code']}")
   ```

2. **é™çº§æµ‹è¯•**
   ```python
   # æµ‹è¯•é™çº§æœºåˆ¶
   renderer = HybridMarkdownRenderer()
   # ç¦ç”¨åŠ¨æ€å¯¼å…¥
   renderer.default_options['use_dynamic_import'] = False
   result = renderer.render("# Test")
   print(f"é™çº§æ¸²æŸ“å™¨: {result['renderer']}")
   ```

## 5. é£é™©ä¸ç¼“è§£

### æ½œåœ¨é£é™©
1. **æ€§èƒ½é£é™©**
   - **é£é™©**ï¼šåŠ¨æ€å¯¼å…¥å¯èƒ½å¢åŠ å¯åŠ¨æ—¶é—´
   - **ç¼“è§£**ï¼šä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œä»…åœ¨é¦–æ¬¡å¯¼å…¥æ—¶äº§ç”Ÿå¼€é”€

2. **å…¼å®¹æ€§é£é™©**
   - **é£é™©**ï¼šå¤–éƒ¨æ¨¡å—æ¥å£å˜åŒ–å¯èƒ½å¯¼è‡´å¯¼å…¥å¤±è´¥
   - **ç¼“è§£**ï¼šå®ç°å¤šå±‚çº§fallbackæœºåˆ¶ï¼Œç¡®ä¿å§‹ç»ˆæœ‰å¯ç”¨æ¸²æŸ“å™¨

3. **é…ç½®é£é™©**
   - **é£é™©**ï¼šé…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´åŠŸèƒ½å¼‚å¸¸
   - **ç¼“è§£**ï¼šæä¾›é»˜è®¤å€¼ï¼Œå®ç°é…ç½®éªŒè¯å’Œé”™è¯¯æç¤º

4. **è·¯å¾„è§£æé£é™©**
   - **é£é™©**ï¼šç›¸å¯¹è·¯å¾„è§£æå¯èƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹å¤±è´¥
   - **ç¼“è§£**ï¼šä½¿ç”¨ `Path` å¯¹è±¡è¿›è¡Œæ ‡å‡†åŒ–è·¯å¾„å¤„ç†

### ç›‘æ§æŒ‡æ ‡
1. **å¯¼å…¥æˆåŠŸç‡**ï¼š`importer.get_import_status()['successful_imports']`
2. **ç¼“å­˜å‘½ä¸­ç‡**ï¼š`importer.get_import_status()['cache_hits']`
3. **æ¸²æŸ“å™¨é€‰æ‹©**ï¼š`result['renderer']` å­—æ®µ
4. **é”™è¯¯é¢‘ç‡**ï¼šæ—¥å¿—ä¸­çš„é”™è¯¯è®°å½•

### å›æ»šæ–¹æ¡ˆ
1. **é…ç½®å›æ»š**ï¼šå°† `use_dynamic_import` è®¾ç½®ä¸º `false`
2. **ä»£ç å›æ»š**ï¼šä½¿ç”¨ `MarkdownRenderer` åˆ«åä¿æŒå…¼å®¹
3. **æ¨¡å—å›æ»š**ï¼šåˆ é™¤ `dynamic_module_importer.py` æ–‡ä»¶

## 6. éƒ¨ç½²å»ºè®®

### éƒ¨ç½²æ­¥éª¤
1. **å¤‡ä»½ç°æœ‰ä»£ç **
   ```bash
   cp core/markdown_renderer.py core/markdown_renderer_backup.py
   ```

2. **éƒ¨ç½²æ–°æ–‡ä»¶**
   ```bash
   # éƒ¨ç½²æ–°æ¨¡å—
   cp core/dynamic_module_importer.py /path/to/production/
   # æ›´æ–°æ¸²æŸ“å™¨
   cp core/markdown_renderer.py /path/to/production/
   # æ›´æ–°é…ç½®
   cp config/app_config.json /path/to/production/
   ```

3. **éªŒè¯éƒ¨ç½²**
   ```python
   # éªŒè¯æ–°åŠŸèƒ½
   from core.markdown_renderer import HybridMarkdownRenderer
   renderer = HybridMarkdownRenderer()
   print("æ··åˆæ¶æ„éƒ¨ç½²æˆåŠŸ")
   ```

### ç›‘æ§è¦ç‚¹
1. **æ—¥å¿—ç›‘æ§**ï¼šå…³æ³¨åŠ¨æ€å¯¼å…¥ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯
2. **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§æ¸²æŸ“æ—¶é—´å’Œç¼“å­˜æ•ˆæœ
3. **é”™è¯¯ç›‘æ§**ï¼šå…³æ³¨å¯¼å…¥å¤±è´¥å’Œé™çº§æƒ…å†µ
4. **ç”¨æˆ·åé¦ˆ**ï¼šæ”¶é›†ç”¨æˆ·å¯¹æ–°åŠŸèƒ½çš„åé¦ˆ

## 7. æ€»ç»“

### å®æ–½æˆæœ
âœ… **æˆåŠŸå®ç°æ··åˆæ¶æ„**ï¼šåŠ¨æ€å¯¼å…¥ + ç»Ÿä¸€è·¯å¾„è§£æ
âœ… **ä¿æŒå‘åå…¼å®¹**ï¼šç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
âœ… **æä¾›æ¸è¿›å¢å¼º**ï¼šé€šè¿‡é…ç½®æ§åˆ¶æ–°åŠŸèƒ½
âœ… **å®Œå–„é”™è¯¯å¤„ç†**ï¼šå¤šå±‚çº§fallbackæœºåˆ¶
âœ… **ä¼˜åŒ–æ€§èƒ½**ï¼šç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤å¯¼å…¥

### æŠ€æœ¯äº®ç‚¹
1. **æ™ºèƒ½å¯¼å…¥**ï¼šåŸºäºé…ç½®çš„åŠ¨æ€æ¨¡å—å¯¼å…¥
2. **ä¼˜å…ˆçº§æ¸²æŸ“**ï¼šä¸‰å±‚çº§æ¸²æŸ“é“¾ç¡®ä¿å¯ç”¨æ€§
3. **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šå®‰å…¨çš„ `sys.path` æ“ä½œ
4. **å¯è§‚æµ‹æ€§**ï¼šè¯¦ç»†çš„å¯¼å…¥çŠ¶æ€å’Œæ€§èƒ½ç»Ÿè®¡
5. **é…ç½®é©±åŠ¨**ï¼šçµæ´»çš„é…ç½®ç®¡ç†

### åç»­ä¼˜åŒ–æ–¹å‘
1. **æ‰©å±•æ¨¡å—æ”¯æŒ**ï¼šæ”¯æŒæ›´å¤šç±»å‹çš„åŠ¨æ€æ¨¡å—
2. **çƒ­é‡è½½åŠŸèƒ½**ï¼šæ”¯æŒè¿è¡Œæ—¶æ¨¡å—é‡è½½
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–å¯¼å…¥å’Œæ¸²æŸ“æ€§èƒ½
4. **ç›‘æ§å¢å¼º**ï¼šæ·»åŠ æ›´å¤šç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦

---

**å®æ–½å®Œæˆæ—¶é—´**ï¼š2025-08-12  
**å®æ–½çŠ¶æ€**ï¼šâœ… å®Œæˆ  
**å…¼å®¹æ€§çŠ¶æ€**ï¼šâœ… å®Œå…¨å…¼å®¹  
**æµ‹è¯•çŠ¶æ€**ï¼šğŸ”„ å¾…æµ‹è¯• 